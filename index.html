<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Domain Storytelling</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="styles/main.css" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
  <div class="app">
    <header class="header">
      <h1><span class="material-icons">account_tree</span>Domain Story</h1>
      <div class="header-actions">
        <button class="btn btn-ghost btn-icon" id="templatesBtn" title="Templates"><span class="material-icons">dashboard</span></button>
        <button class="btn btn-ghost btn-icon" id="helpBtn" title="Help"><span class="material-icons">help_outline</span></button>
        <button class="btn btn-secondary btn-icon" id="iconPickerBtn" title="Icons"><span class="material-icons">emoji_symbols</span></button>
        <button class="btn btn-primary btn-icon" id="exportBtn" title="Export"><span class="material-icons">download</span></button>
      </div>
    </header>
    <nav class="tabs">
      <button class="tab active" data-panel="editor"><span class="material-icons">edit_note</span>Edit<span class="tab-badge" id="errorBadge" style="display:none">0</span></button>
      <button class="tab" data-panel="diagram"><span class="material-icons">schema</span>Diagram</button>
      <button class="tab" data-panel="steps"><span class="material-icons">list</span>Steps</button>
    </nav>
    <div class="main-content">
      <section class="panel editor-panel active" id="editor-panel">
        <div class="editor-container">
          <div class="editor-toolbar">
            <button class="btn btn-ghost btn-sm" id="undoBtn" title="Undo"><span class="material-icons">undo</span></button>
            <button class="btn btn-ghost btn-sm" id="redoBtn" title="Redo"><span class="material-icons">redo</span></button>
            <span class="toolbar-divider"></span>
            <button class="btn btn-ghost btn-sm" id="clearBtn" title="Clear"><span class="material-icons">delete_outline</span></button>
          </div>
          <div class="editor-wrapper">
            <textarea class="editor" id="storyInput" placeholder="# My Domain Story
> [user-story] As a user I want...
> [requirement] System must...

@Customer (person)
@System (computer)

## Main Flow
Customer interacts with System"></textarea>
            <div class="autocomplete" id="autocomplete"></div>
          </div>
          <div class="validation-bar" id="validationBar"><span class="material-icons">check_circle</span><span id="validationText">Ready</span></div>
          <div class="quick-bar">
            <span class="quick-chip" data-action="domain"><span class="material-icons">folder</span> Domain</span>
            <span class="quick-chip" data-action="actor"><span class="material-icons">person_add</span> Actor</span>
            <span class="quick-chip" data-action="flow"><span class="material-icons">arrow_forward</span> Flow</span>
            <span class="quick-chip" data-action="step"><span class="material-icons">add</span> Step</span>
            <span class="quick-chip" data-action="userstory"><span class="material-icons">auto_stories</span> Story</span>
            <span class="quick-chip" data-action="requirement"><span class="material-icons">checklist</span> Req</span>
          </div>
        </div>
      </section>
      <section class="panel diagram-panel" id="diagram-panel">
        <div class="diagram-container" id="diagramContainer">
          <div class="diagram-canvas" id="diagramCanvas"></div>
          <svg class="diagram-svg" id="diagramSvg"></svg>
          <div class="diagram-toolbar">
            <div class="layout-dropdown">
              <button class="btn btn-secondary btn-sm" id="layoutBtn"><span class="material-icons">auto_fix_high</span> Layout</button>
              <div class="layout-menu" id="layoutMenu">
                <div class="layout-menu-item" data-layout="flow"><span class="material-icons">arrow_forward</span> Flow (Leftâ†’Right)</div>
                <div class="layout-menu-item" data-layout="circular"><span class="material-icons">radio_button_unchecked</span> Circular</div>
                <div class="layout-menu-item" data-layout="force"><span class="material-icons">hub</span> Force-Directed</div>
                <div class="layout-menu-item" data-layout="grid"><span class="material-icons">grid_view</span> Grid</div>
              </div>
            </div>
          </div>
          <div class="story-selector" id="storySelector"></div>
          <div class="zoom-indicator" id="zoomIndicator">100%</div>
          <div class="diagram-controls">
            <button class="btn btn-secondary btn-icon" id="zoomInBtn"><span class="material-icons">add</span></button>
            <button class="btn btn-secondary btn-icon" id="zoomOutBtn"><span class="material-icons">remove</span></button>
            <button class="btn btn-secondary btn-icon" id="fitBtn"><span class="material-icons">fit_screen</span></button>
          </div>
          <div class="empty-state" id="emptyState"><span class="material-icons">draw</span><p>Your diagram will appear here</p><button class="btn btn-primary" id="startEditingBtn">Start Editing</button></div>
        </div>
        <div class="desktop-steps-section" id="desktopSteps" style="display:none">
          <div class="steps-toggle" id="stepsToggle"><span>Steps & Notes</span><span class="material-icons">expand_less</span></div>
          <div class="steps-container" id="desktopStepsContainer"></div>
        </div>
      </section>
      <section class="panel steps-panel" id="steps-panel">
        <div class="steps-container" id="stepsContainer"><div class="empty-state"><span class="material-icons">format_list_numbered</span><p>Steps will appear here</p></div></div>
      </section>
    </div>
  </div>
  <div class="export-container" id="exportContainer"></div>
  <div class="modal-overlay" id="helpModal">
    <div class="modal">
      <div class="modal-header"><h2>How to Use</h2><button class="btn btn-icon btn-ghost" id="closeHelpBtn"><span class="material-icons">close</span></button></div>
      <div class="modal-body">
        <div class="syntax-section"><h3><span class="material-icons">folder</span> Domain Story Groups</h3><p>Use # to create groups (As-Is, To-Be, releases)</p><div class="syntax-block"># Incident Record As-Is
# Incident Record To-Be</div></div>
        <div class="syntax-section"><h3><span class="material-icons">sticky_note_2</span> Notes & Requirements</h3><p>Use > with tags for notes</p><div class="syntax-block">> [user-story] As a user I want...
> [requirement] System must...
> [assumption] We assume...
> [risk] There is a risk...</div></div>
        <div class="syntax-section"><h3><span class="material-icons">person</span> Define Actors</h3><div class="syntax-block">@Customer (person)
@System (computer) "annotation"</div></div>
        <div class="syntax-section"><h3><span class="material-icons">sync_alt</span> Flows & Steps</h3><p>Use natural whitespace syntax (or legacy comma syntax)</p><div class="syntax-block">## Checkout Process
Customer adds item to Cart {Product}
Cart confirms to Customer "success"

# Legacy comma syntax also supported:
Customer, adds item to, Cart {Product}</div></div>
      </div>
    </div>
  </div>
  <div class="modal-overlay" id="templatesModal">
    <div class="modal">
      <div class="modal-header"><h2>Templates</h2><button class="btn btn-icon btn-ghost" id="closeTemplatesBtn"><span class="material-icons">close</span></button></div>
      <div class="modal-body"><div class="template-grid" id="templateGrid"></div></div>
    </div>
  </div>
  <div class="icon-picker-overlay" id="iconPickerOverlay">
    <div class="icon-picker">
      <div class="icon-picker-header">
        <h3>Choose Icon</h3>
        <input type="text" class="icon-search" id="iconSearch" placeholder="Search icons..." />
        <div class="icon-categories" id="iconCategories">
          <span class="icon-category active" data-category="suggested">Suggested</span>
          <span class="icon-category" data-category="people">People</span>
          <span class="icon-category" data-category="tech">Tech</span>
          <span class="icon-category" data-category="all">All</span>
        </div>
      </div>
      <div class="icon-grid" id="iconGrid"></div>
    </div>
  </div>
  <svg class="measure-svg" id="measureSvg"><text id="measureText" font-size="10"></text></svg>

  <!-- Load scripts in dependency order -->
  <script src="scripts/state.js"></script>
  <script src="scripts/parser.js"></script>
  <script src="scripts/diagram.js"></script>
  <script src="scripts/renderer.js"></script>
  <script src="scripts/main.js"></script>
</body>
</html>
